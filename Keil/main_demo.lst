C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE MAIN_DEMO
OBJECT MODULE PLACED IN .\main_demo.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\source\main_demo.c LARGE OPTIMIZE(9,SIZE) BROWSE NOAREGS INTVECTOR(0X
                    -0300) INCDIR(..\include;..\BLE Service;..\Lcd) DEBUG OBJECTEXTEND PRINT(.\main_demo.lst) TABS(2) OBJECT(.\main_demo.obj)

line level    source

   1          /*****************************************************************************
   2          **               AMICCOM Electronics Corporation Document                   **
   3          **          Copyright (c) 2011-2015 AMICCOM Electronics Corporation         **
   4          **                                                                          **
   5          **      A3,1F,No.1, Li-Hsin 1th Road, Science_Based Industrid Park,         **
   6          **                       Hsin_Chu City, 300, Taiwan, ROC.                   **
   7          **                 Tel: 886-3-5785818   Fax: 886-3-5785819                  **
   8          **         E-mail:info@amiccom.com.tw  http: //www.amiccom.com.tw           **
   9          *****************************************************************************/
  10          #include "define.h"
  11          #include "A8107.h"
  12          #include "LibFunction.h"
  13          #include "mcufunction.h"
  14          #include "IAP.h"
  15          #include "servicegen.h"
  16          #include "OTA.h"
  17          #include "LcdFun.h"
  18          #include "RcADC.h"
  19          //#include "..\Lcd\LCD.h"
  20          
  21          uint8_t xdata        auth_req;
  22          uint8_t xdata        init_req;
  23          uint8_t xdata        index;
  24          uint8_t xdata        auth_init_finish;
  25          uint8_t xdata        scale_index;
  26          uint8_t xdata        KeyWakeup;
  27          uint8_t xdata    sendscaledata;
  28          uint8_t xdata    waitpacket;
  29          
  30          #ifdef _PROFILE_TAOBAO_
              uint8_t xdata    sendscaledata;
              uint8_t xdata scalebuf[10];
              uint16_t xdata weightvalue;
              uint32_t xdata    datevalue;
              #endif
  36          
  37          #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_MOUSE_
              uint8_t xdata HID_report_MS_key_temp;
              uint8_t xdata mousedata;
              #endif
              #ifdef _PROFILE_HOGP_KEYBOARD_
              uint8_t xdata HID_report_KB_key_temp;
              uint8_t xdata presskey07;
              #endif
              #ifdef _PROFILE_HOGP_COMSUMER_
              uint8_t xdata presskey06; 
              #endif
              #endif
  50          
  51          
  52          #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_MOUSE_
              void MouseDemo(void);
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 2   

              #endif
              #endif
  57          
  58          #ifdef _PROFILE_TAOBAO_
              uint8_t toascii(uint32_t in, uint8_t unit);
              void Prcss_Weight(void);
              #endif
  62          
  63          #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_COMSUMER_
              #define HDL_HIDS_REPORT_TAB_CSKEY_L                             0
              #define HDL_HIDS_REPORT_TAB_CSKEY_H                             1
              #endif
              
              #ifdef _PROFILE_HOGP_MOUSE_
              #define HDL_HIDS_REPORT_TAB_KEY_L_R                             0
              #define HDL_HIDS_REPORT_TAB_DIR_L_R_L                           1
              #define HDL_HIDS_REPORT_TAB_DIR_L_R_H                           2
              #define HDL_HIDS_REPORT_TAB_DIR_U_D_L                           3
              #define HDL_HIDS_REPORT_TAB_DIR_U_D_H                           4
              #define HDL_HIDS_REPORT_TAB_ROL_U_D                             5
              #endif
              
              #ifdef _PROFILE_HOGP_KEYBOARD_
              #define HDL_HIDS_REPORT_TAB_KEY_CTRL                            0
              #define HDL_HIDS_REPORT_TAB_KEY_DATA0                           2
              #define HDL_HIDS_REPORT_TAB_KEY_DATA1                           3
              #define HDL_HIDS_REPORT_TAB_KEY_DATA2                           4
              #define HDL_HIDS_REPORT_TAB_KEY_DATA3                           5
              #define HDL_HIDS_REPORT_TAB_KEY_DATA4                           6
              #define HDL_HIDS_REPORT_TAB_KEY_DATA5                           7
              #endif
              #endif
  88          
  89          #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_COMSUMER_
              const uint8_t code HID_RPT_CS_KEY_DEMO[][2] =
              {
                  {0xE9, 0x00,},  //vol+
                  {0xEA, 0x00,},  //vol-
                  {0xE2, 0x00,},  //Mute
                  {0xB0, 0x00,},  //Play
                  {0xB1, 0x00,},  //Pause
                  //{0xB2, 0x00,},  //Record
                  {0xB3, 0x00,},  //Fast forward
                  {0xB4, 0x00,},  //Rewind
                  {0xB5, 0x00,},  //Scan next track
                  {0xB6, 0x00,},  //Scan previous track
                  {0xB7, 0x00,},  //Stop
                  {0xB8, 0x00,},  //Eject
                  {0x8A, 0x01,},  //Email reader
                  {0x96, 0x01,},  //Internet browser
                  {0x9E, 0x01,},  //Terminal lock/screensaver
                  {0xC6, 0x01,},  //Research/search browser
                  {0x2D, 0x02,},  //Zoom in
              };
              #endif
              #endif
 113          
 114          #ifdef _PROFILE_TAOBAO_
              const uint8_t code auth_data_taobao[60]=
              {
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 3   

                  0x03, 0x00, 0x26, 0xFE, 0x01, 0x00, 0x26, 0x27,
                  0x11, 0x00, 0x01, 0x0A, 0x00, 0x12, 0x10, 0x8A,
                  0xB7, 0x40, 0x66, 0x48,                   
                  0x7C, 0x9A, 0xDE, 0x17, 0x5B, 0x80, 0xD7, 0xD7,
                  0x0C, 0x83, 0x0B, 0x18, 0x83, 0x80, 0x04, 0x20,
                  0x01, 0x28, 0x01, 0x32,                   
                  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                  0x00, 0x00, 0x00, 0x00
              };
              
              const uint8_t code init_data_taobao[20]=
              {
                  0x03, 0x00, 0x0D, 0xFE, 0x01, 0x00, 0x0D, 0x27,
                  0x13, 0x00, 0x02, 0x0A, 0x00, 0x12, 0x01, 0x7F,
                  0x00, 0x00, 0x00, 0x00
              };
              
              const uint8_t code send_test_data_taobao[60]=
              {
                  0x03, 0x00, 0x36, 0xFE, 0x01, 0x00, 0x36, 0x27,
                  0x12, 0x00, 0x03, 0x0A, 0x00, 0x12, 0x2A, 0x43,
                  0x43, 0x30, 0x37, 0x39,                   
                  0x36, 0x37, 0x34, 0x32, 0x34, 0x45, 0x46, 0x45,
                  0x39, 0x33, 0x31, 0x33, 0x30, 0x33, 0x38, 0x32,
                  0x30, 0x30, 0x30, 0x34,                   
                  0x31, 0x33, 0x30, 0x33, 0x31, 0x33, 0x36, 0x34,
                  0x31, 0x33, 0x30, 0x33, 0x30, 0x33, 0x31, 0x30,
                  0x38, 0x00, 0x00, 0x00
              };
              
              const uint8_t code scale_data_init[10]=
              {
                  0x01, 0x30, 0x30, 0x30, 0x30, 0x42, 0x46, 0x38,
                  0x33, 0x43,
              };
              
              static const char ascii[] = "0123456789ABCDEF";
              
              const uint8_t code send_scale_data[60]=
              {
                  0x03, 0x00, 0x34, 0xFE, 0x01, 0x00, 0x34, 0x27,
                  0x12, 0x00, 0x00, 0x0A, 0x00, 0x12, 0x26, 0x43,
                  0x33, 0x46, 0x45, 0x30,                   
                  0x30, 0x30, 0x36, 0x45, 0x30, 0x35, 0x35, 0x44,
                  0x36, 0x42, 0x34, 0x43, 0x41, 0x46, 0x46, 0x30,
                  0x30, 0x30, 0x30, 0x30,                   
                  0x30, 0x46, 0x46, 0x30, 0x30, 0x30, 0x30, 0x30,
                  0x30, 0x30, 0x30, 0x30, 0x39, 0x18, 0x00, 0x00,
                  0x00, 0x00, 0x00, 0x00
              };
              #endif
 169          
 170          #ifdef _PROFILE_WECHAT_
              const uint8_t code auth_data_wechat[26]=
              {
                  0xFE, 0x01, 0x00, 0x1A, 0x27, 0x11, 0x00, 0x01,
                  0x0A, 0x00, 0x18, 0x80, 0x80, 0x04, 0x20, 0x01,
                  0x28, 0x02, 0x3A, 0x06, 0xD0, 0x39, 0x72, 0xA5,
                  0xEF, 0x24
              };
              
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 4   

              const uint8_t code init_data_wechat[19]=
              {
                  0xFE, 0x01, 0x00, 0x13, 0x27, 0x13, 0x00, 0x02,
                  0x0A, 0x00, 0x1A, 0x04, 0x30, 0x37, 0x31, 0x35,
                  0x12, 0x01, 0x41
              };
              
              const uint8_t code send_test_data_wechat[19]=
              {
                  0xFE, 0x01, 0x00, 0x13, 0x27, 0x12, 0x00, 0x02,
                  0x0A, 0x00, 0x1A, 0x04, 0x30, 0x37, 0x31, 0x35,
                  0x12, 0x01, 0x41
              };
              
              #ifdef _PROFILE_WECHAT_SIMPLE_MODE_
              const uint8_t code current_step_data[4] =
              {
                  0x01, 0x10, 0x27, 0x00
              };
              
              const uint8_t code current_total_data[10]=
              {
                  0x07, 0x10, 0x27, 0x00, 0x70, 0x17, 0x00, 0x00,
                  0x22, 0x33
              };
              
              const uint8_t code target_data[19]=
              {
                  0xFE, 0x01, 0x00, 0x13, 0x27, 0x12, 0x00, 0x02,
                  0x0A, 0x00, 0x1A, 0x04, 0x30, 0x37, 0x31, 0x35,
                  0x12, 0x01, 0x41
              };
              #endif
              #endif
 213          extern uint32_t xdata RA_Test;
 214          uint8_t xdata   updataFlag;
 215          uint8_t xdata   Sec_Conut;
 216          uint8_t xdata   LCD_Display[3];
 217          /*******************************************************************
 218           *
 219           * main - main function
 220           * Description:
 221           *      The function is the system entry point. The whole system is
 222           *      start from here.
 223           *
 224           ******************************************************************/
 225          void main(void)
 226          {
 227   1      //    uint8_t j;
 228   1          ADV_InitDef ADV_InitStructure;
 229   1      
 230   1          uint8_t xdata   DataLen;
 231   1          uint8_t xdata   *ptrChar = NULL;
 232   1          uint8_t xdata   UpdateOTASpeed;
 233   1          uint8_t xdata   Temp;
 234   1          uint8_t xdata   result, i;
 235   1          uint16_t xdata     waitpacket_tmp = 0, waitpacket_tmp1 = 0, waitpacket_tmp2 = 0;
 236   1          sint8_t disp_integer,disp_decimal;
 237   1          sint16_t TempVal;
 238   1          //while(~P0_4);    
 239   1      
 240   1          InterruptDisable();
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 5   

 241   1          InitMCU();
 242   1          internalRC = 0; //0 :Using External RC 32.768KHz ; 1:Using internal RC 32.000KHz
 243   1          
 244   1          InitCrystalCL(0x0D);  //AMICCOM CrystalCL 0x32(MD8107-A05)(18pF) / 0x14(MD8107-A06)(12pF) / 0x0D(9pF)
 245   1          
 246   1      //TempVal = Get_temperature();
 247   1          InitRF();
 248   1          XBYTE[0x20FF]=0x04;    
 249   1      //TempVal = Get_temperature();
 250   1      //XBYTE[TCKG1_REG] = 0x04;
 251   1      //rf_config_w[110] = 0x04;
 252   1      //Get_temperature(&disp_integer,&disp_decimal);
 253   1          IAP_Initialize();
 254   1          OTA_Initialize();
 255   1          
 256   1      //TempVal = Get_temperature();
 257   1          InitBLE();
 258   1      //TempVal = Get_temperature();
 259   1          BLE_SetTxPower(6); //level 0 ~ 7 : 0 => -17dBm; 1 => -15dBm; 2 => -10dBm; 3 => -5dBm; 4 => 0dBm; 5 => 
             -2dBm; 6 => 4dBm; 7 => 7dBm
 260   1          InterruptEnable();
 261   1          
 262   1      #ifdef _PROFILE_TAOBAO_
                  for(i=0;i<10;i++)
                      scalebuf[i]=scale_data_init[i];
              
                  weightvalue=0;
                  datevalue=559240;
                  datevalue=788888;
              #endif
 270   1      
 271   1          Sec_Conut =0;
 272   1      //TempVal = Get_temperature();
 273   1          RF_Timer500ms(ENABLE);
 274   1      //TempVal = Get_temperature();
 275   1          //LCD start
 276   1      /*XBYTE[0x200B] = 0x12;
 277   1      P3WUN = 0xF3;
 278   1      BLE_AutoPwrDown_Enable();
 279   1      while(P3_3==0)
 280   1      _nop_();
 281   1      while(P3_2==0)
 282   1      _nop_();
 283   1      for (RA_Test=0;RA_Test<1000;RA_Test++)
 284   1      {
 285   1      _nop_();
 286   1      _nop_();
 287   1      }
 288   1      */
 289   1      InitLCD();
 290   1      
 291   1          LCDON(ENABLE);
 292   1      /*    while (Timer500ms_flag==0);
 293   1          Timer500ms_flag=0;
 294   1          while (Timer500ms_flag==0);
 295   1          Timer500ms_flag=0;
 296   1          Display_4mux(1,1);
 297   1          Display_4mux(2,2);
 298   1          Display_4mux(3,3);
 299   1          Display_4mux(4,4);
 300   1          Display_4mux(5,5);
 301   1          Display_4mux(6,6);
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 6   

 302   1      */
 303   1          for(i=0;i<10;i++)
 304   1          {
 305   2      //    while (Timer500ms_flag==0);
 306   2      //    Timer500ms_flag=0;
 307   2              Display_4mux(1,i);
 308   2              Display_4mux(2,i);
 309   2              Display_4mux(3,i);
 310   2              Display_4mux(4,i);
 311   2              Display_4mux(5,i);
 312   2              Display_4mux(6,i);
 313   2              while (Timer500ms_flag==0);
 314   2              Timer500ms_flag=0;
 315   2          }
 316   1          //LCD end 
 317   1      /*
 318   1      P3WUN = 0xF3;
 319   1      BLE_AutoPwrDown_Enable();
 320   1      */
 321   1      
 322   1      RA_Test = 1800;
 323   1          while(1)
 324   1          {
 325   2              OTA_Process();
 326   2              
 327   2              /* User Can Add Code */
 328   2              
 329   2              if(ble_state == STANDBY_STATE)
 330   2              {
 331   3                  ADV_InitStructure.ADV_Timing = 16; // ADV Interval = (20ms + 0.625ms*ADV_Timing) = 100 ms
 332   3                  ADV_InitStructure.ADV_TO = 1500;  // ADV Timeout = ADV Interval * ADV_TO = 20ms*1500 = 30 sec
 333   3                  ADV_InitStructure.ADV_Channel = (TE_ADVCHANNEL)(ADV_CH37 | ADV_CH38 | ADV_CH39);
 334   3                  ADV_InitStructure.ADV_Type = ADV_IND;
 335   3                  ADV_InitStructure.ADV_RndEnable = DISABLE;
 336   3                  ADV_InitStructure.ADV_TOEnable = DISABLE;
 337   3                  ADV_InitStructure.ADV_Run = ENABLE;    
 338   3                  BLE_ADV_Cmd(&ADV_InitStructure);
 339   3      
 340   3      updataFlag = 0;
 341   3      
 342   3      #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_MOUSE_
                          HID_report_MS_key_temp = 0x00;
                          mousedata = 0;
              #endif
              #ifdef _PROFILE_HOGP_KEYBOARD_
                          presskey07 = 0;
              #endif
              #ifdef _PROFILE_HOGP_COMSUMER_
                          presskey06 = 0;
              #endif
              #endif
 354   3      
 355   3      #ifdef _PROFILE_WECHAT_
              #ifdef _PROFILE_WECHAT_SIMPLE_MODE_
                          for(i=0;i<10;i++)
                              att_HDL_WECHAT_SIMPLEMODE_DATRWI[i] = current_total_data[i];
                          att_HDL_WECHAT_SIMPLEMODE_DATRWI[20] = 10;
              #endif
              #endif
 362   3                  auth_req = FAIL;
 363   3                  init_req = FAIL;
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 7   

 364   3                  auth_init_finish = FAIL;
 365   3                  index = 0;
 366   3                  scale_index = 0;
 367   3                  KeyWakeup = 0;
 368   3                  sendscaledata = FAIL;
 369   3                  waitpacket=0;
 370   3              }
 371   2              else if(ble_state == ADV_STATE)
 372   2              {
 373   3                  UpdateOTASpeed = ENABLE;
 374   3              }
 375   2              else if(ble_state == CONNECT_ESTABLISH_STATE)
 376   2              {
 377   3                  if (UpdateOTASpeed)
 378   3                  {
 379   4                      Temp = (uint8_t)OTA_UpdataSpeed();
 380   4                     
 381   4                      if ((OTA_SUCCESSFUL == Temp) || (OTA_COUNT_MAX == Temp))
 382   4                          UpdateOTASpeed = DISABLE;
 383   4                  } /* Changing OTA download speeds */
 384   3      if (updataFlag==0)
 385   3      {
 386   4          //BLE_SetConnectParameterUpdateRequest(0x0100,0x0190, 0x00, 0x0258);//500ms
 387   4          BLE_SetConnectParameterUpdateRequest(0x0040,0x0050, 0x00, 0x0258);//100ms
 388   4          updataFlag =1;
 389   4      }                                               
 390   3                  if (BLE_writeEventFlag)
 391   3                  {
 392   4                      ptrChar = BLE_GetWriteEvent();
 393   4                      DataLen = BLE_GetWriteEvent_Length();
 394   4                      
 395   4                      if (ptrChar == &att_HDL_OTA_OTA_DATA)
 396   4                      {
 397   5                          OTA_SetReceiveData((uint16_t)att_HDL_OTA_OTA_DATA, DataLen);
 398   5                          OTA_Process();
 399   5                      } /* Characteristic Data below the OTA Service */
 400   4                      else if (ptrChar == &att_HDL_OTA_OTA_CMD_CONTROL_POINT)
 401   4                      {
 402   5                          OTA_SetReceiveData((uint16_t)att_HDL_OTA_OTA_CMD_CONTROL_POINT, DataLen);
 403   5                          OTA_Process();
 404   5                      } /* Characteristic Command below the OTA Service */
 405   4      #ifdef _PROFILE_TAOBAO_
                              else if(ptrChar == &att_HDL_TAOBAO_DATW)
                              {
                                  if(waitpacket==0)
                                  {
                                      if(att_HDL_TAOBAO_DATW[7]==0x4E)
                                      {
                                          waitpacket_tmp1=att_HDL_TAOBAO_DATW[1];
                                          waitpacket_tmp2=att_HDL_TAOBAO_DATW[2];
                                          waitpacket_tmp=((waitpacket_tmp1<<8)|(waitpacket_tmp2))+3;
                                          
                                          if((waitpacket_tmp%20)==0)
                                              waitpacket=((waitpacket_tmp)/20)-1;
                                          else if((waitpacket_tmp%20)!=0)
                                              waitpacket=((waitpacket_tmp+3)/20);
                                          else
                                              ;
                                          
                                          switch(att_HDL_TAOBAO_DATW[8])
                                          {
                                              case 0x21:
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 8   

                                                  auth_req = PASS;
                                                  break;
                                              
                                              case 0x22:
                                                  auth_init_finish = PASS;
                                                  break;
                                              
                                              case 0x23:
                                                  init_req = PASS;
                                                  break;
                                              
                                              default:
                                                  break;
                                          }
                                      }
                                      else
                                             ;
                                  }
                                  else
                                  {
                                      waitpacket--;
                                  }
                              }
              #endif
 450   4      #ifdef _PROFILE_WECHAT_
              #ifndef _PROFILE_WECHAT_SIMPLE_MODE_
                              else if(ptrChar == &att_HDL_WECHAT_DATW)//WeChat
                              {
                                  if(waitpacket==0)
                                  {
                                      if(att_HDL_WECHAT_DATW[4]==0x4E)
                                      {
                                          waitpacket_tmp1=att_HDL_WECHAT_DATW[2];
                                          waitpacket_tmp2=att_HDL_WECHAT_DATW[3];
                                          waitpacket_tmp=((waitpacket_tmp1<<8)|(waitpacket_tmp2));
                                          
                                          if((waitpacket_tmp%20)==0)
                                              waitpacket=((waitpacket_tmp)/20)-1;
                                          else if((waitpacket_tmp%20)!=0)
                                              waitpacket=((waitpacket_tmp)/20);
                                          else
                                              ;
                                          
                                          switch(att_HDL_WECHAT_DATW[5])
                                          {
                                              case 0x21:
                                                  auth_req = PASS;
                                                  break;
                                          
                                              case 0x22:
                                                  auth_init_finish = PASS;
                                                  break;
                                          
                                              case 0x23:
                                                  init_req = PASS;
                                                  break;
                                          
                                              default:
                                                  break;
                                          }
                                      }
                                      else if(att_HDL_WECHAT_DATW[4]==0x75)
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 9   

                                      {
                                          waitpacket_tmp1=att_HDL_WECHAT_DATW[2];
                                          waitpacket_tmp2=att_HDL_WECHAT_DATW[3];
                                          waitpacket_tmp=((waitpacket_tmp1<<8)|(waitpacket_tmp2));
                                          
                                          if((waitpacket_tmp%20)==0)
                                              waitpacket=((waitpacket_tmp)/20)-1;
                                          else if((waitpacket_tmp%20)!=0)
                                              waitpacket=((waitpacket_tmp)/20);
                                          else
                                              ;
                                          
                                          switch(att_HDL_WECHAT_DATW[5])
                                          {
                                              case 0x31:
                                                  _nop_();
                                                  break;
                                                  
                                              case 0x32:
                                                  _nop_();
                                                  break;
                                                  
                                              case 0x33:
                                                  _nop_();
                                                  break;
                                                  
                                              default:
                                                  break;
                                          }
                                      }
                                      else
                                          ;
                                  }
                                  else
                                  {
                                            waitpacket--;
                                  }
                              }
              #else
                              else if(ptrChar == &att_HDL_WECHAT_SIMPLEMODE_DATRWI)//WeChat_Simple//手機寫步數
                              {
                                  switch(att_HDL_WECHAT_SIMPLEMODE_DATRWI[0])
                                  {
                                      case 0x01:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,4);
                                          break;
                                      
                                      case 0x02:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,4);
                                          break;
                                      
                                      case 0x03:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,7);
                                          break;
                                      
                                      case 0x04:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,4);
                                          break;
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 10  

                                      
                                      case 0x05:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,7);
                                          break;
                                      
                                      case 0x06:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,7);
                                          break;
                                      
                                      case 0x07:
                                          result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMO
             -DE_DATRWI_INIT,10);
                                          break;
                                      
                                      default:
                                          break;
                                  }
                              }
              #endif
              #endif
 565   4      #ifdef _PROFILE_USER_DEFINE_01_
 566   4                      else if(ptrChar == &att_HDL_USER_DEFINE_01_DATAW01)
 567   4                      {
 568   5                          _nop_();
 569   5      
 570   5                          if((att_HDL_USER_DEFINE_01_DATAN01_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCR
             -IPTORS_CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
 571   5                          {
 572   6                              _nop_();
 573   6                              /*for(i=0;i<20;i++)
 574   6                                        att_HDL_USER_DEFINE_01_DATAN01[i] = att_HDL_USER_DEFINE_01_DATAW01[i];//
             -*/
 575   6                              
 576   6      /*                        TempVal = Get_temperature();
 577   6                              //Get_temperature(&disp_integer,&disp_decimal);
 578   6                              att_HDL_USER_DEFINE_01_DATAN01[0] = disp_integer;
 579   6                              att_HDL_USER_DEFINE_01_DATAN01[1] = disp_decimal;
 580   6      
 581   6                              result = BLE_SendData(att_HDL_USER_DEFINE_01_DATAN01,ATT_HDL_USER_DEFINE_01_DATAN0
             -1_INIT,2);                        
 582   6                              
 583   6                              if(result == SUCCESS)
 584   6                              {
 585   6                                  _nop_();
 586   6                              }
 587   6                              else
 588   6                              {
 589   6                                  _nop_();
 590   6                              }
 591   6                              Display_4mux(1,att_HDL_USER_DEFINE_01_DATAW01[5]);
 592   6                              Display_4mux(2,att_HDL_USER_DEFINE_01_DATAW01[4]);
 593   6                              //Display_4mux(3,att_HDL_USER_DEFINE_01_DATAW01[3]);
 594   6                              //Display_4mux(4,att_HDL_USER_DEFINE_01_DATAW01[2]);
 595   6                              Display_4mux(5,att_HDL_USER_DEFINE_01_DATAW01[3]);
 596   6                              Display_4mux(6,att_HDL_USER_DEFINE_01_DATAW01[2]);
 597   6      */
 598   6      /*                        for( j = 0 ; j < 6 ; j++)
 599   6                              {
 600   6                                  Display_4mux(j+1,att_HDL_USER_DEFINE_01_DATAW01[5-j]);    
 601   6                              } 
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 11  

 602   6      */
 603   6                          }                                       
 604   5                      }
 605   4                      else if(ptrChar == &att_HDL_USER_DEFINE_01_DATAW02)
 606   4                      {
 607   5                          if((att_HDL_USER_DEFINE_01_DATAN02_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCR
             -IPTORS_CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
 608   5                          {
 609   6                              for(i=0;i<20;i++)
 610   6                                  att_HDL_USER_DEFINE_01_DATAN02[i] = att_HDL_USER_DEFINE_01_DATAW02[i];
 611   6                              
 612   6                              result = BLE_SendData(att_HDL_USER_DEFINE_01_DATAN02,ATT_HDL_USER_DEFINE_01_DATAN0
             -2_INIT,5);
 613   6                              
 614   6                              if(result == SUCCESS)
 615   6                              {
 616   7                                  _nop_();
 617   7                              }
 618   6                              else
 619   6                              {
 620   7                                  _nop_();
 621   7                              }
 622   6                          }                    
 623   5                      }
 624   4      #endif
 625   4      #ifdef _PROFILE_USER_TEMPERTURE_
 626   4                      
 627   4                      else if(ptrChar == &att_HDL_USER_DEVICENAME_RW01)
 628   4                      {
 629   5                          _nop_();
 630   5      
 631   5                          if((att_HDL_USER_DEFINE_01_DATAN01_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCR
             -IPTORS_CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
 632   5                          {
 633   6                              _nop_();
 634   6                          }                                       
 635   5                      }
 636   4                      else if(ptrChar == &att_HDL_USER_DEFINE_01_DATAW02)
 637   4                      {
 638   5                          if((att_HDL_USER_DEFINE_01_DATAN02_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCR
             -IPTORS_CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
 639   5                          {
 640   6                              for(i=0;i<20;i++)
 641   6                                  att_HDL_USER_DEFINE_01_DATAN02[i] = att_HDL_USER_DEFINE_01_DATAW02[i];
 642   6                              
 643   6                              result = BLE_SendData(att_HDL_USER_DEFINE_01_DATAN02,ATT_HDL_USER_DEFINE_01_DATAN0
             -2_INIT,5);
 644   6                              
 645   6                              if(result == SUCCESS)
 646   6                              {
 647   7                                  _nop_();
 648   7                              }
 649   6                              else
 650   6                              {
 651   7                                  _nop_();
 652   7                              }
 653   6                          }                    
 654   5                      }
 655   4      #endif
 656   4                      else
 657   4                      {
 658   5                      
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 12  

 659   5                      }
 660   4                  }
 661   3      
 662   3      #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_MOUSE_
                          if(~P3_2)
                          {
                              do{
                                  MouseDemo();
                              }while(~P3_2);
                          }
              #endif
              #ifdef _PROFILE_HOGP_KEYBOARD_
                          if(~P0_7)
                          {
                              if((att_HDL_HIDS_REPORT_KBI_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCRIPTORS_CLIE
             -NT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
                              {
                                  if((HID_report_KB_key_temp < 0x04)||(HID_report_KB_key_temp >= 0x27))  //a~9
                                  {
                                      HID_report_KB_key_temp = 0x04;
                                  }
                                  else
                                  {
                                      HID_report_KB_key_temp++;
                                  }
                                  att_HDL_HIDS_REPORT_KBI[HDL_HIDS_REPORT_TAB_KEY_DATA0] = HID_report_KB_key_temp;
                                  result = BLE_SendData(att_HDL_HIDS_REPORT_KBI,ATT_HDL_HIDS_REPORT_KBI_INIT,ATT_HDL_HID
             -S_REPORT_KBI_INIT[4]);
                                  if(result == SUCCESS)
                                  {
                                      presskey07 = 1;
                                  }
                              }
                          }
                          else
                          {
                              if(presskey07)
                              {
                                  if((att_HDL_HIDS_REPORT_KBI_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCRIPTORS_
             -CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
                                  {
                                      att_HDL_HIDS_REPORT_KBI[HDL_HIDS_REPORT_TAB_KEY_DATA0] = 0x00;
                                      result = BLE_SendData(att_HDL_HIDS_REPORT_KBI,ATT_HDL_HIDS_REPORT_KBI_INIT,ATT_HDL
             -_HIDS_REPORT_KBI_INIT[4]);
                                      if(result == SUCCESS)
                                      {
                                          presskey07 = 0;
                                      }
                                  }
                              }
                          }
              #endif
              #ifdef _PROFILE_HOGP_COMSUMER_
                          if(~P0_6)
                          {
                              if((att_HDL_HIDS_REPORT_CSI_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCRIPTORS_CLIE
             -NT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
                              {
                                  att_HDL_HIDS_REPORT_CSI[HDL_HIDS_REPORT_TAB_CSKEY_L] = HID_RPT_CS_KEY_DEMO[0][0];
                                  att_HDL_HIDS_REPORT_CSI[HDL_HIDS_REPORT_TAB_CSKEY_H] = HID_RPT_CS_KEY_DEMO[0][1];
                                  result = BLE_SendData(att_HDL_HIDS_REPORT_CSI,ATT_HDL_HIDS_REPORT_CSI_INIT,ATT_HDL_HID
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 13  

             -S_REPORT_CSI_INIT[4]);
                                  if(result == SUCCESS)
                                  {
                                      presskey06 = 1;
                                  }
                              }
                          }
                          else
                          {
                              if(presskey06)
                              {
                                  if((att_HDL_HIDS_REPORT_CSI_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCRIPTORS_
             -CLIENT_CHARACTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
                                  {
                                      att_HDL_HIDS_REPORT_CSI[HDL_HIDS_REPORT_TAB_CSKEY_L] = 0x00;
                                      att_HDL_HIDS_REPORT_CSI[HDL_HIDS_REPORT_TAB_CSKEY_H] = 0x00;
                                      result = BLE_SendData(att_HDL_HIDS_REPORT_CSI,ATT_HDL_HIDS_REPORT_CSI_INIT,ATT_HDL
             -_HIDS_REPORT_CSI_INIT[4]);
                                      if(result == SUCCESS)
                                      {
                                          presskey06 = 0;
                                      }
                                  }
                              }
                          }
              #endif
              #endif
 740   3      
 741   3      #ifdef _PROFILE_TAOBAO_
                          if((att_HDL_TAOBAO_DATI_MEASUREMENT_CLIENT_CHARACTERISTIC_CONFIGURATION[0]&GATT_DESCRIPTORS_CL
             -IENT_CHARACTERISTIC_CONFIGURATION_INDICATION) != 0)
                          {
                              if(auth_req == FAIL && waitpacket == 0)
                              {
                                  switch(index)
                                  {
                                      case 0x00:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = auth_data_taobao[i];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                          
                                      case 0x01:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = auth_data_taobao[i+20];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                          
                                      case 0x02:
                                          for(i=0;i<20;i++)
                                                    att_HDL_TAOBAO_DATI[i] = auth_data_taobao[i+20+20];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                          {
                                              index++;
                                              //auth_req = PASS;
                                          }
                                          break;
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 14  

                                          
                                      default:
                                          break;
                                  }
                              }
                              else if(auth_req == PASS && init_req == FAIL && waitpacket == 0)
                              {
                                  switch(index)
                                  {
                                      case 0x03:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = init_data_taobao[i];
                                      
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                      
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                      
                                      default:
                                          break;
                                  }
                              }
                              else if(auth_init_finish == FAIL && waitpacket == 0)
                              {
                                  switch(index)
                                  {
                                      case 0x04:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = send_test_data_taobao[i];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                  
                                                  case 0x05:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = send_test_data_taobao[i+20];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                          
                                      case 0x06:
                                          for(i=0;i<20;i++)
                                              att_HDL_TAOBAO_DATI[i] = send_test_data_taobao[i+20+20];
                                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                                          if(result == SUCCESS)
                                          {
                                              //auth_init_finish = PASS;
                                                 index++;
                                          }
                                          break;
                                          
                                      default:
                                          break;
                                  }
                              }
                              else
                                  ;
                          }
              #endif
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 15  

 836   3      #ifdef _PROFILE_WECHAT_
              #ifndef _PROFILE_WECHAT_SIMPLE_MODE_
                          if((att_HDL_WECHAT_DATI_MEASUREMENT_CLIENT_CHARACTERISTIC_CONFIGURATION[0]&GATT_DESCRIPTORS_CL
             -IENT_CHARACTERISTIC_CONFIGURATION_INDICATION) != 0)
                          {
                              if(auth_req == FAIL && waitpacket == 0)
                              {
                                  switch(index)
                                  {
                                      case 0x00:
                                          for(i=0;i<20;i++)
                                              att_HDL_WECHAT_DATI[i] = auth_data_wechat[i];
                                          result = BLE_SendData(att_HDL_WECHAT_DATI,ATT_HDL_WECHAT_DATI_INIT,20);
                                          if(result == SUCCESS)
                                              index++;
                                      break;
                                      
                                      case 0x01:
                                          for(i=0;i<6;i++)
                                              att_HDL_WECHAT_DATI[i] = auth_data_wechat[i+20];
                                          result = BLE_SendData(att_HDL_WECHAT_DATI,ATT_HDL_WECHAT_DATI_INIT,6);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                      
                                      default:
                                          break;
                                  }
                              }
                              else if(auth_req == PASS && init_req == FAIL && waitpacket == 0)
                              {
                                  switch(index)
                                  {
                                      case 0x02:
                                          for(i=0;i<19;i++)
                                              att_HDL_WECHAT_DATI[i] = init_data_wechat[i];
                                      
                                          result = BLE_SendData(att_HDL_WECHAT_DATI,ATT_HDL_WECHAT_DATI_INIT,19);
                                          if(result == SUCCESS)
                                                 index++;
                                      break;
                                      
                                      default:
                                          break;
                                  }
                              }
                              else if(auth_req == PASS && init_req == PASS && auth_init_finish == FAIL && waitpacket == 
             -0)
                              {
                                  switch(index)
                                  {
                                      case 0x03:
                                          for(i=0;i<19;i++)
                                              att_HDL_WECHAT_DATI[i] = send_test_data_wechat[i];
                                          result = BLE_SendData(att_HDL_WECHAT_DATI,ATT_HDL_WECHAT_DATI_INIT,19);
                                          if(result == SUCCESS)
                                              index++;
                                          break;
                                          
                                      default:
                                          break;
                                  }
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 16  

                              }
                              else
                                  ;
                          }
              #else
                          if((att_HDL_WECHAT_SIMPLEMODE_DATRI_CLIENT_CHARACTERISTIC_CONFIGURATION[0]&GATT_DESCRIPTORS_CL
             -IENT_CHARACTERISTIC_CONFIGURATION_INDICATION) != 0)
                          {
                              switch(index)
                              {
                                  case 0x00:
                                      for(i=0;i<4;i++)
                                          att_HDL_WECHAT_SIMPLEMODE_DATRI[i] = current_step_data[i];
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRI,ATT_HDL_WECHAT_SIMPLEMODE_DA
             -TRI_INIT,4);
                                      att_HDL_WECHAT_SIMPLEMODE_DATRI[20]=4;
                                      if(result == SUCCESS)
                                          index++;
                                      break;
                                  
                                  case 0x01:
                                      for(i=0;i<10;i++)
                                          att_HDL_WECHAT_SIMPLEMODE_DATRI[i] = current_total_data[i];
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRI,ATT_HDL_WECHAT_SIMPLEMODE_DA
             -TRI_INIT,10);
                                      att_HDL_WECHAT_SIMPLEMODE_DATRI[20]=10;
                                      if(result == SUCCESS)
                                          index++;
                                      break;
                                  
                                  default:
                                      break;
                              }                
                          }
                          else if((att_HDL_WECHAT_SIMPLEMODE_DATRWI_CLIENT_CHARACTERISTIC_CONFIGURATION[0]&GATT_DESCRIPT
             -ORS_CLIENT_CHARACTERISTIC_CONFIGURATION_INDICATION) != 0)
                          {
                              switch(att_HDL_WECHAT_SIMPLEMODE_DATRWI[0])
                              {
                                  case 0x01:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,4);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  case 0x02:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,4);
                                      if(result == SUCCESS)
                                          _nop_();
                                                  break;
                                  
                                  case 0x03:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,7);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  case 0x04:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 17  

             -ATRWI_INIT,4);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  case 0x05:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,7);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  case 0x06:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,7);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  case 0x07:
                                      result = BLE_SendData(att_HDL_WECHAT_SIMPLEMODE_DATRWI,ATT_HDL_WECHAT_SIMPLEMODE_D
             -ATRWI_INIT,10);
                                      if(result == SUCCESS)
                                          _nop_();
                                      break;
                                  
                                  default:
                                      break;
                              }
                          }
              #endif
              #endif
 979   3      
 980   3                  if(auth_init_finish == PASS && waitpacket == 0)
 981   3                  {
 982   4      #ifdef _PROFILE_TAOBAO_
                              Prcss_Weight();
              #endif
 985   4                  }
 986   3              }
 987   2              
 988   2              if(Timer500ms_flag)
 989   2              {
 990   3                  Timer500ms_flag = 0;
 991   3                  Sec_Conut++;
 992   3                  XBYTE[0x20C5] = XBYTE[0x20C5] ^ 0x08 ;
 993   3                  XBYTE[0x20E1] = XBYTE[0x20E1] ^ 0x08 ;
 994   3                  
 995   3                  if (Sec_Conut&0x01)
 996   3                  {
 997   4                      //Get_temperature(&disp_integer,&disp_decimal);
 998   4                      TempVal = Get_temperature();
 999   4                      disp_integer = TempVal/10;
1000   4                      if (TempVal&0x8000)
1001   4                      {
1002   5                          Display_4mux(6,10);
1003   5                          TempVal = TempVal ^ 0xFFFF;
1004   5                          TempVal++;
1005   5                      }
1006   4                      else
1007   4                          Display_4mux(6,12);
1008   4                      disp_decimal = TempVal%10;
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 18  

1009   4      
1010   4                      att_HDL_USER_DEFINE_01_DATAN01[0] = disp_integer;
1011   4                      att_HDL_USER_DEFINE_01_DATAN01[1] = disp_decimal;
1012   4      
1013   4                      disp_integer = TempVal/10;//for display
1014   4      
1015   4                      LCD_Display[2] = disp_integer/10;
1016   4                      LCD_Display[1] = disp_integer%10;
1017   4                      LCD_Display[0] = disp_decimal;
1018   4      
1019   4                      Display_4mux(1,11);
1020   4                      Display_4mux(2,13);
1021   4                      Display_4mux(3,LCD_Display[0]);
1022   4                      Display_4mux(4,LCD_Display[1]);
1023   4                      if (disp_integer>9)
1024   4                          Display_4mux(5,LCD_Display[2]);
1025   4                      else
1026   4                          Display_4mux(5,12);
1027   4      
1028   4                      if(ble_state == CONNECT_ESTABLISH_STATE)
1029   4                          result = BLE_SendData(att_HDL_USER_DEFINE_01_DATAN01,ATT_HDL_USER_DEFINE_01_DATAN01_IN
             -IT,2);                        
1030   4                              
1031   4                  }
1032   3                  XBYTE[0x20C8] = XBYTE[0x20C8] | 0x08 ;
1033   3                  XBYTE[0x20E4] = XBYTE[0x20E4] | 0x08 ;
1034   3              }
1035   2      
1036   2              BLE_AutoPwrDown_Enable();
1037   2          }
1038   1      }
1039          
1040          #ifdef _PROFILE_HOGP_
              #ifdef _PROFILE_HOGP_MOUSE_
              void MouseDemo(void)
              {
                  uint8_t result;
              
                  if(mousedata == 0)
                  {
                      if((att_HDL_HIDS_REPORT_MSI_CLIENT_CHARACTERISTIC_CONFIGURATION[0] & GATT_DESCRIPTORS_CLIENT_CHARA
             -CTERISTIC_CONFIGURATION_NOTIFICATION) != 0)
                      {
                          HID_report_MS_key_temp++;
                          if(HID_report_MS_key_temp <= 0x3F)
                          {
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_L] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_H] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_L] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_H] = 0xFF;
                          }
                          else if(HID_report_MS_key_temp <= 0x7F)
                          {
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_L] = 0x01;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_H] = 0x00;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_L] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_H] = 0xFF;
                          }
                          else if(HID_report_MS_key_temp <= 0xBF)
                          {
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_L] = 0x01;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_H] = 0x00;
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 19  

                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_L] = 0x01;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_H] = 0x00;
                          }
                          else if(HID_report_MS_key_temp <= 0xFF)
                          {
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_L] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_L_R_H] = 0xFF;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_L] = 0x01;
                              att_HDL_HIDS_REPORT_MSI[HDL_HIDS_REPORT_TAB_DIR_U_D_H] = 0x00;
                          }
              
                          result = BLE_SendData(att_HDL_HIDS_REPORT_MSI,ATT_HDL_HIDS_REPORT_MSI_INIT,ATT_HDL_HIDS_REPORT
             -_MSI_INIT[4]);
                          if(result == SUCCESS)
                          {
                              mousedata = 0;
                          }
                          else
                          {
                              mousedata = 1;
                          }
                      }
                  }
                  else
                  {
                      result = BLE_SendData(att_HDL_HIDS_REPORT_MSI,ATT_HDL_HIDS_REPORT_MSI_INIT,ATT_HDL_HIDS_REPORT_MSI
             -_INIT[4]);
                      if(result == SUCCESS)
                      {
                          mousedata = 0;
                      }
                      else
                      {
                          mousedata = 1;
                      }
                  }
              }
              #endif
              #endif
1106          
1107          #ifdef _PROFILE_TAOBAO_
              void Prcss_Weight(void)
              {
                  uint8_t i,result,tmp;
                  
                  switch(scale_index)
                  {
                      case 0x00:
                          for(i=0;i<20;i++)
                              att_HDL_TAOBAO_DATI[i] = send_scale_data[i];
                          
                          att_HDL_TAOBAO_DATI[10]=scalebuf[0];
                          scalebuf[0]++;
                          
                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                          if(result == SUCCESS)
                              scale_index++;                                            
                          break;
                          
                      case 0x01:
                          for(i=0;i<20;i++)
                              att_HDL_TAOBAO_DATI[i] = send_scale_data[i+20];
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 20  

                          att_HDL_TAOBAO_DATI[1]=scalebuf[1];
                          att_HDL_TAOBAO_DATI[2]=scalebuf[2];
                          att_HDL_TAOBAO_DATI[3]=scalebuf[3];
                          att_HDL_TAOBAO_DATI[4]=scalebuf[4];
                          att_HDL_TAOBAO_DATI[8]=scalebuf[5];
                          att_HDL_TAOBAO_DATI[9]=scalebuf[6];
                          att_HDL_TAOBAO_DATI[10]=scalebuf[7];
                          att_HDL_TAOBAO_DATI[11]=scalebuf[8];
                          att_HDL_TAOBAO_DATI[12]=scalebuf[9];
                          
                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                          if(result == SUCCESS)
                          {
                              weightvalue = weightvalue+100;
                              
                              tmp=toascii(weightvalue,3);
                              scalebuf[1]=tmp;
                              tmp=toascii(weightvalue,2);
                              scalebuf[2]=tmp;                        
                              tmp=toascii(weightvalue,1); 
                              scalebuf[3]=tmp;                        
                              tmp=toascii(weightvalue,0);
                              scalebuf[4]=tmp;
                              
                              datevalue = datevalue+100;
                              tmp=toascii(datevalue,4);
                              scalebuf[5]=tmp;
                              tmp=toascii(datevalue,3);
                              scalebuf[6]=tmp;                        
                              tmp=toascii(datevalue,2);
                              scalebuf[7]=tmp;                        
                              tmp=toascii(datevalue,1);
                              scalebuf[8]=tmp;                        
                              tmp=toascii(datevalue,0);
                              scalebuf[9]=tmp;    
                                                  
                              scale_index++;
                          }
                          break;
                          
                      case 0x02:
                          for(i=0;i<20;i++)
                              att_HDL_TAOBAO_DATI[i] = send_scale_data[i+20+20];
                          result = BLE_SendData(att_HDL_TAOBAO_DATI,ATT_HDL_TAOBAO_DATI_INIT,20);
                          if(result == SUCCESS)
                          {
                              scale_index++;
                              KeyWakeup = 0;
                          }
                          break;
                      
                      default:
                          break;
                  }                                                                    
              
              }
              
              /*********************************************************************
              **  toascii
              *********************************************************************/
              uint8_t toascii(uint32_t in, uint8_t unit)
              {
C51 COMPILER V9.53.0.0   MAIN_DEMO                                                         11/05/2018 10:15:37 PAGE 21  

                  uint8_t tmp;
              
                  tmp = ascii[(in>>(unit*4))&0x0F];
                  return tmp;
              }
              #endif


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    909    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     13      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
